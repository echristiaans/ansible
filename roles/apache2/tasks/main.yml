---
- name: Install Apache
  yum:
    pkg={{ item }}
    state=present
  with_items:
    - httpd
  become: yes

- name: Ensure httpd is running
  service:
    name=httpd
    state=started

- name: Ensure httpd is enabled
  service:
    name=httpd
    enabled=yes

- name: Create a VirtualHost file for server stats
  template:
    src=apache_server_stats.conf.j2
    dest=/etc/httpd/conf.d/apache_server_stats.conf
    owner=root
    group=root
    mode=0644
  notify:
    - reload httpd

- name: Remove VirtualHost file for each disabled VirtualHost
  file:
    path=/etc/httpd/conf.d/{{ item.documentrootdir }}.conf
    state=absent
  with_items: apache_vhosts_disabled
  notify:
    - reload httpd

- name: Remove web directories for each disabled VirtualHost
  file:
    path=/var/www/html/{{ item.documentrootdir }}
    state=absent
  with_items: apache_vhosts_disabled

